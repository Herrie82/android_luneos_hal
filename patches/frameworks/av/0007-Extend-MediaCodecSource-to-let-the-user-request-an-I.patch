From 72fad1965dfb08e94d94216f694e57d35361fcbf Mon Sep 17 00:00:00 2001
From: Simon Fels <simon.fels@canonical.com>
Date: Fri, 19 Feb 2016 07:59:51 +0100
Subject: [PATCH 07/10] Extend MediaCodecSource to let the user request an IDR
 frame

Change-Id: I434cb5022222894946abf1e1579554e0fa079157
---
 include/media/stagefright/MediaCodecSource.h | 2 ++
 media/libstagefright/MediaCodecSource.cpp    | 7 +++++++
 2 files changed, 9 insertions(+)

diff --git a/include/media/stagefright/MediaCodecSource.h b/include/media/stagefright/MediaCodecSource.h
index edd6494..b956906 100644
--- a/include/media/stagefright/MediaCodecSource.h
+++ b/include/media/stagefright/MediaCodecSource.h
@@ -53,6 +53,8 @@ struct MediaCodecSource : public MediaSource,
     bool isVideo() const { return mIsVideo; }
     sp<IGraphicBufferProducer> getGraphicBufferProducer();
 
+    status_t requestIDRFrame();
+
     // MediaSource
     virtual status_t start(MetaData *params = NULL);
     virtual status_t stop();
diff --git a/media/libstagefright/MediaCodecSource.cpp b/media/libstagefright/MediaCodecSource.cpp
index 7c81570..f2f2a9f 100644
--- a/media/libstagefright/MediaCodecSource.cpp
+++ b/media/libstagefright/MediaCodecSource.cpp
@@ -900,4 +900,11 @@ void MediaCodecSource::onMessageReceived(const sp<AMessage> &msg) {
     }
 }
 
+status_t MediaCodecSource::requestIDRFrame() {
+    if (mEncoder == NULL)
+        return NO_INIT;
+
+    return mEncoder->requestIDRFrame();
+}
+
 } // namespace android
-- 
2.7.4

